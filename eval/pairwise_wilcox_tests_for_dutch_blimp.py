# -*- coding: utf-8 -*-
"""pairwise wilcox tests for dutch blimp.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1Ogiq7O5hJa_XLbQDp2aeKGCCLUwv6GQC
"""

!pip install pandas scipy statsmodels

import pandas as pd
from scipy.stats import friedmanchisquare, wilcoxon
from statsmodels.stats.multitest import multipletests

# IGNORE THIS ONE!!!
# Step 1: Define your data (example: use your BLiMP table values)
# Each row = paradigm, each column = model
data = {
    'Paradigm': [
        'Overall', 'adjunct_island', 'anaphor_gender_agreement',
        'anaphor_number_agreement', 'animate_subject_passive'  # ... add all paradigms
    ],
    'English_Goldfish': [0.7795, 0.8400, 0.9720, 0.9900, 0.7810],
    'B_GPT_NL_EN_seq': [0.7941, 0.8200, 0.9890, 0.9910, 0.7950],
    'B_GPT_NL_EN_sim': [0.7844, 0.8690, 0.9910, 0.9880, 0.7890],
    'B_GPT_EN_NL_seq': [0.6397, 0.7580, 0.9370, 0.9460, 0.6870],
    'B_GPT_EN_NL_sim': [0.7962, 0.7700, 0.9940, 0.9900, 0.7810]
}

df = pd.DataFrame(data)

# Step 2: Friedman test
# Convert to matrix: each column = model, each row = paradigm
model_cols = ['English_Goldfish', 'B_GPT_NL_EN_seq', 'B_GPT_NL_EN_sim',
              'B_GPT_EN_NL_seq', 'B_GPT_EN_NL_sim']

friedman_stat, p_value = friedmanchisquare(*(df[col].values for col in model_cols))
print(f"Friedman chi-square = {friedman_stat:.3f}, p = {p_value:.4f}")

# Step 3: Post-hoc Wilcoxon signed-rank tests with Holm-Bonferroni correction
from itertools import combinations

p_vals = []
pairs = list(combinations(model_cols, 2))

for m1, m2 in pairs:
    stat, p = wilcoxon(df[m1], df[m2])
    p_vals.append(p)

# Holm-Bonferroni correction
reject, p_corrected, _, _ = multipletests(p_vals, method='holm')

# Show results
for (m1, m2), p_unc, p_corr, rej in zip(pairs, p_vals, p_corrected, reject):
    print(f"{m1} vs {m2}: p_unc={p_unc:.4f}, p_corr={p_corr:.4f}, significant={rej}")

import pandas as pd
from scipy.stats import friedmanchisquare, wilcoxon
from statsmodels.stats.multitest import multipletests
from itertools import combinations

# Step 1: Define your data (NL-BLiMP table values)
data = {
    'Phenomenon': ['Adpositional phrases', 'Adverbial modification', 'Anaphor agreement',
        'Argument structure', 'Auxiliaries', 'Binding principle A', 'Complementive',
        'Crossing dependencies', 'Determiners', 'Extraposition', 'Finite argument clause',
        'Infinitival argument clause', 'Nominalisation', 'Parasitic gaps', 'Passive',
        'Quantifiers', 'R-words', 'Relativisation', 'Topicalisation', 'Verb-second',
        'Wh-movement', 'Wh-movement restrictions'
    ],
    'Dutch_goldfish': [1.000, 0.97, 0.94, 0.87, 0.976, 0.985, 0.92, 1.000, 0.892, 0.987, 0.8,
        0.918, 0.935, 0.168, 0.887, 0.99, 0.995, 0.753, 0.805, 1.0, 0.776, 0.733
    ],
    'EN_NL_simultaneous': [0.695, 0.49, 0.545, 0.4175, 0.606, 0.74, 0.632, 0.41, 0.0875, 0.6733, 0.5033,
        0.7878, 0.595, 0.0725, 0.7275, 0.595, 0.18, 0.5667, 0.26, 0.51, 0.575, 0.7067
    ],
    'EN_NL_sequential': [0.475, 0.44, 0.61, 0.4037, 0.36, 0.735, 0.622, 0.5, 0.105, 0.55, 0.525,
        0.7089, 0.16, 0.19, 0.715, 0.49, 0.37, 0.4267, 0.21, 0.4, 0.65, 0.615
    ],
    'NL_EN_sequential': [0.86, 0.62, 0.68, 0.41, 0.702, 0.695, 0.674, 0.22, 0.3075, 0.59, 0.4667,
        0.6767, 0.7, 0.1375, 0.5525, 0.475, 0.4550, 0.1, 0.1, 0.36, 0.49, 0.5533
    ],
    'NL_EN_simultaneous': [1.0, 0.97, 0.94, 0.87, 0.976, 0.985, 0.92, 1.0, 0.8925, 0.9867, 0.8,
        0.9178, 0.935, 0.1675, 0.8875, 0.99, 0.9950, 0.7533, 0.805, 1.0, 0.7758, 0.7333
    ]
}

df = pd.DataFrame(data)
df

# Models columns
model_cols = ['Dutch_goldfish', 'EN_NL_simultaneous', 'EN_NL_sequential',
              'NL_EN_sequential', 'NL_EN_simultaneous']

# Friedman test
friedman_stat, p_value = friedmanchisquare(*(df[col].values for col in model_cols))
print(f"Friedman chi-square = {friedman_stat:.3f}, p = {p_value:.4f}")

# Pairwise Wilcoxon tests
p_vals = []
pairs = list(combinations(model_cols, 2))

for m1, m2 in pairs:
    stat, p = wilcoxon(df[m1], df[m2])
    p_vals.append(p)

# Holm-Bonferroni correction
reject, p_corrected, _, _ = multipletests(p_vals, method='holm')

# Display results
for (m1, m2), p_unc, p_corr, rej in zip(pairs, p_vals, p_corrected, reject):
    print(f"{m1} vs {m2}: p_unc={p_unc:.4f}, p_corr={p_corr:.4f}, significant={rej}")