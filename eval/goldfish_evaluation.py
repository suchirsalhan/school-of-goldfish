# -*- coding: utf-8 -*-
"""goldfish_evaluation.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1sjRl-U_kFN3aDdz2Z44JMlLg9ULzx8bL
"""

# Install Hugging Face transformers and lm-eval
!pip install git+https://github.com/babylm-org/multilingual-evaluation.git
!pip install transformers

import torch
torch.cuda.is_available()

# Commented out IPython magic to ensure Python compatibility.
!git clone https://github.com/EleutherAI/lm-evaluation-harness.git
# %cd lm-evaluation-harness
!pip install -e .

!python3 -m lm_eval --tasks list | grep -i 'xnli\|mnli'

!python3 -m lm_eval ls tasks

!python3 -m lm_eval ls tasks | grep -i 'xnli\|mnli\|sib'

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/spa_latn_1000mb \
  --tasks xnli_es \
  --device cuda \
  --output_path /content/results_xnli_es.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/ell_grek_1000mb \
  --tasks xnli_el \
  --device cuda \
  --output_path /content/results_xnli_el.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/pol_latn_1000mb \
  --tasks xnli_pl \
  --device cuda \
  --output_path /content/results_xnli_pl.json

!python3 -m lm_eval ls tasks | grep -i xnli

!git clone https://github.com/babylm-org/multilingual-evaluation.git

!cp -r multilingual-evaluation/tasks/* lm_eval/tasks/

!python3 -m lm_eval ls tasks | grep -i xnli

# Commented out IPython magic to ensure Python compatibility.
# %cd /content/lm-evaluation-harness/lm_eval/tasks

# Commented out IPython magic to ensure Python compatibility.
# %cd /content

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/ell_grek_1000mb \
  --tasks sib200_ell_Grek\
  --device cuda \
  --output_path /content/results_sib200_el.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/pol_latn_1000mb \
  --tasks sib200_pol_Latn\
  --device cuda \
  --output_path /content/results_sib200_pol.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/eng_latn_1000mb \
  --tasks sib200_eng_Latn\
  --device cuda \
  --output_path /content/results_sib200_eng.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/nld_latn_1000mb \
  --tasks sib200_nld_Latn\
  --device cuda \
  --output_path /content/results_sib200_nld.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/spa_latn_1000mb \
  --tasks sib200_spa_Latn\
  --device cuda \
  --output_path /content/results_sib200_spa.json

!python3 -m lm_eval run \
    --model hf \
    --model_args pretrained=goldfish-models/spa_latn_1000mb \
    --tasks sib200_spa_Latn \
    --include_path /content/lm-evaluation-harness/multilingual-evaluation \
    --device cuda \
    --output_path /content/results_sib200_spa.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/eng_latn_1000mb \
  --tasks bmlama_en_mubench\
  --device cuda \
  --output_path /content/results_bmlama_en.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/ell_grek_1000mb \
  --tasks bmlama_el_mubench\
  --device cuda \
  --output_path /content/results_bmlama_el.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/spa_latn_1000mb \
  --tasks bmlama_es_mubench\
  --device cuda \
  --output_path /content/results_bmlama_spa.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/nld_latn_1000mb \
  --tasks bmlama_nl_mubench\
  --device cuda \
  --output_path /content/results_bmlama_nld.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/pol_latn_1000mb \
  --tasks bmlama_pl_mubench\
  --device cuda \
  --output_path /content/results_bmlama_pol.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/eng_latn_1000mb \
  --tasks truthfulqa_en_mubench \
  --device cuda \
  --output_path /content/results_truthfulqa_en.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/nld_latn_1000mb \
  --tasks truthfulqa_nl_mubench \
  --device cuda \
  --output_path /content/results_truthfulqa_nld.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/spa_latn_1000mb \
  --tasks truthfulqa_es_mubench \
  --device cuda \
  --output_path /content/results_truthfulqa_spa.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/ell_grek_1000mb \
  --tasks truthfulqa_el_mubench \
  --device cuda \
  --output_path /content/results_truthfulqa_ell.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/pol_latn_1000mb \
  --tasks truthfulqa_pl_mubench \
  --device cuda \
  --output_path /content/results_truthfulqa_pol.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/ell_grek_1000mb \
  --tasks xcomps_el \
  --device cuda \
  --output_path /content/results_xcomps_el.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/nld_latn_1000mb \
  --tasks xcomps_nl \
  --device cuda \
  --output_path /content/results_xcomps_nld.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/spa_latn_1000mb \
  --tasks xcomps_es \
  --device cuda \
  --output_path /content/results_xcomps_spa.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/spa_latn_1000mb \
  --tasks multinli_es_mubench \
  --device cuda \
  --output_path /content/results_mnli_spa.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/nld_latn_1000mb \
  --tasks multinli_nl_mubench \
  --device cuda \
  --output_path /content/results_extra_nld_goldfish.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/ell_grek_1000mb \
  --tasks multinli_el_mubench \
  --device cuda \
  --output_path /content/results_extra_ell_goldfish.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/pol_latn_1000mb \
  --tasks multinli_pl_mubench \
  --device cuda \
  --output_path /content/results_extra_pol_goldfish.json



!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/eng_latn_1000mb \
  --tasks arc_easy_en_mubench \
  --device cuda \
  --output_path /content/results_arc_eng.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/ell_grek_1000mb \
  --tasks arc_easy_el_mubench \
  --device cuda \
  --output_path /content/results_arc_ell.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/nld_latn_1000mb \
  --tasks arc_easy_nl_mubench \
  --device cuda \
  --output_path /content/results_arc_nld.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/spa_latn_1000mb \
  --tasks arc_easy_es_mubench \
  --device cuda \
  --output_path /content/results_arc_spa.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/pol_latn_1000mb \
  --tasks arc_easy_pl_mubench \
  --device cuda \
  --output_path /content/results_arc_pol.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/eng_latn_1000mb \
  --tasks snli_en_mubench \
  --device cuda \
  --output_path /content/results_snli_en.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/nld_latn_1000mb \
  --tasks snli_nl_mubench \
  --device cuda \
  --output_path /content/results_snli_nld.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/spa_latn_1000mb \
  --tasks snli_es_mubench \
  --device cuda \
  --output_path /content/results_snli_spa.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/ell_grek_1000mb \
  --tasks snli_el_mubench \
  --device cuda \
  --output_path /content/results_snli_ell.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=goldfish-models/pol_latn_1000mb \
  --tasks snli_pl_mubench \
  --device cuda \
  --output_path /content/results_snli_pol.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=catherinearnett/B-GPT_en_nl_sequential \
  --tasks multiblimp_eng,snli_en_mubench,sib200_eng_Latn,arc_easy_en_mubench \
  --device cuda \
  --output_path /content/results_multi_en_BGPT_en_nl_sequential.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=catherinearnett/B-GPT_en_nl_sequential \
  --tasks truthfulqa_en_mubench \
  --device cuda \
  --output_path /content/results_truthfulqa_en_BGPT_en_nl_sequential.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=catherinearnett/B-GPT_en_nl_sequential \
  --tasks bmlama_en_mubench \
  --device cuda \
  --output_path /content/results_bmlama_en_BGPT_en_nl_sequential.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=catherinearnett/B-GPT_en_nl_sequential \
  --tasks xcomps_nl \
  --device cuda \
  --output_path /content/results_xcomps_nl_BGPT_en_nl_sequential.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=catherinearnett/B-GPT_en_nl_sequential \
  --tasks multiblimp_nld,snli_nl_mubench,sib200_nld_Latn,arc_easy_nl_mubench,truthfulqa_nl_mubench \
  --device cuda \
  --output_path /content/results_multi_nl_BGPT_en_nl_sequential.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=catherinearnett/B-GPT_en_es_sequential \
  --tasks multiblimp_eng,snli_en_mubench,sib200_eng_Latn,arc_easy_en_mubench,truthfulqa_en_mubench \
  --device cuda \
  --output_path /content/results_multi_en_BGPT_en_es_sequential.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=catherinearnett/B-GPT_en_el_sequential \
  --tasks multiblimp_eng,snli_en_mubench,sib200_eng_Latn,arc_easy_en_mubench,truthfulqa_en_mubench \
  --device cuda \
  --output_path /content/results_multi_en_BGPT_en_el_sequential.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=catherinearnett/B-GPT_en_pl_sequential \
  --tasks multiblimp_eng,snli_en_mubench,sib200_eng_Latn,arc_easy_en_mubench,truthfulqa_en_mubench,multiblimp_pol,snli_pl_mubench,sib200_pol_Latn,arc_easy_pl_mubench,truthfulqa_pl_mubench \
  --device cuda \
  --output_path /content/results_multi_BGPT_en_pl_sequential.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=catherinearnett/B-GPT_pl_en_sequential \
  --tasks multiblimp_eng,snli_en_mubench,sib200_eng_Latn,arc_easy_en_mubench,truthfulqa_en_mubench,multiblimp_pol,snli_pl_mubench,sib200_pol_Latn,arc_easy_pl_mubench,truthfulqa_pl_mubench \
  --device cuda \
  --output_path /content/results_multi_BGPT_pl_en_sequential.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=catherinearnett/B-GPT_es_en_sequential \
  --tasks multiblimp_eng,snli_en_mubench,sib200_eng_Latn,arc_easy_en_mubench,truthfulqa_en_mubench,multiblimp_spa,snli_es_mubench,sib200_spa_Latn,arc_easy_es_mubench,truthfulqa_es_mubench,multinli_es_mubench,multinli_en_mubench \
  --device cuda \
  --output_path /content/results_multi_BGPT_es_en_sequential.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=catherinearnett/B-GPT_en_es_sequential \
  --tasks multiblimp_spa,snli_es_mubench,sib200_spa_Latn,arc_easy_es_mubench,truthfulqa_es_mubench,multinli_es_mubench,multinli_en_mubench,xcomps_es \
  --device cuda \
  --output_path /content/results_extra_BGPT_en_es_sequential.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=catherinearnett/B-GPT_en_el_sequential \
  --tasks multiblimp_ell,multinli_el_mubench,multinli_en_mubench,snli_el_mubench,sib200_ell_Grek,arc_easy_el_mubench,truthfulqa_el_mubench,xcomps_el \
  --device cuda \
  --output_path /content/results_multi_el_BGPT_en_el_sequential.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=catherinearnett/B-GPT_nl_en_sequential \
  --tasks multiblimp_eng,multiblimp_nld,multinli_en_mubench,multinli_nl_mubench,snli_en_mubench,snli_nl_mubench,sib200_nld_Latn,sib200_eng_Latn,truthfulqa_en_mubench,truthfulqa_nl_mubench,xcomps_nl,arc_easy_en_mubench,arc_easy_nl_mubench \
  --device cuda \
  --output_path /content/results_multi_both_BGPT_nl_en_sequential.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=catherinearnett/B-GPT_en_el_simultaneous \
  --tasks multiblimp_ell,multiblimp_eng,multinli_el_mubench,multinli_en_mubench,snli_el_mubench,snli_en_mubench,sib200_ell_Grek,sib200_eng_Latn,arc_easy_el_mubench,arc_easy_en_mubench,truthfulqa_el_mubench,truthfulqa_en_mubench,xcomps_el \
  --device cuda \
  --output_path /content/results_multi_el_BGPT_en_el_simultaneous.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=catherinearnett/B-GPT_nl_en_simultaneous \
  --tasks multiblimp_nld,multiblimp_eng \
  --device cuda \
  --output_path /content/results_multiblimp_BGPT_nl_en_simultaneous.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=catherinearnett/B-GPT_en_es_simultaneous \
  --tasks bmlama_en_mubench,bmlama_es_mubench \
  --device cuda \
  --output_path /content/results_bmlama_BGPT_en_es_simultaneous.json

!python3 -m lm_eval run \
  --model hf \
  --model_args pretrained=catherinearnett/B-GPT_es_en_simultaneous \
  --tasks bmlama_en_mubench,bmlama_es_mubench \
  --device cuda \
  --output_path /content/results_bmlama_BGPT_es_en_simultaneous.json