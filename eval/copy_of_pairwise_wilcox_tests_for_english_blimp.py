# -*- coding: utf-8 -*-
"""Copy of pairwise wilcox tests for English blimp.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1EPm4jxCJFuq3yvwJCN_jKSLvl4fBL8iD
"""

!pip install pandas scipy statsmodels

import pandas as pd
from scipy.stats import friedmanchisquare, wilcoxon
from statsmodels.stats.multitest import multipletests

import pandas as pd
from scipy.stats import friedmanchisquare, wilcoxon
from statsmodels.stats.multitest import multipletests
from itertools import combinations

blimp_df = pd.read_csv("blimpresults.csv")
print(blimp_df.info())
print(blimp_df)
df = pd.DataFrame(blimp_df)
print(blimp_df.head())

print(df)

# Models columns
#model_cols = ['English Goldfish', 'B-GPT NL_EN sequential', 'B-GPT NL_EN simultaneous',
       #       'NL_EN_sequential', 'NL_EN_simultaneous']
model_cols = df.columns.values.tolist()
model_cols.remove("Paradigm")
# Friedman test
friedman_stat, p_value = friedmanchisquare(*(df[col].values for col in model_cols))
print(f"Friedman chi-square = {friedman_stat:.3f}, p = {p_value:.4f}")

# Pairwise Wilcoxon tests
p_vals = []
#pairs = list(combinations(model_cols, 2))
pairs = [("English Goldfish", x) for x in model_cols if x != "English Goldfish"]

for m1, m2 in pairs:
    stat, p = wilcoxon(df[m1], df[m2])
    p_vals.append(p)

# Holm-Bonferroni correction
reject, p_corrected, _, _ = multipletests(p_vals, method='holm')

# Display results
for (m1, m2), p_unc, p_corr, rej in zip(pairs, p_vals, p_corrected, reject):
    print(f"{m1} vs {m2}: p_unc={p_unc:.4f}, p_corr={p_corr:.4f}, significant={rej}")